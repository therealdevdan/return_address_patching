```markdown
# Перехват ожидающих потоков через модификацию адреса возврата

**Реализация скрытного метода инъекции кода на языке Rust**

## Суть метода

Данная технология представляет собой усовершенствованный способ внедрения постороннего кода в работающие процессы операционной системы Windows. В отличие от традиционных подходов, этот метод не требует принудительной остановки потоков выполнения, что делает его практически незаметным для систем мониторинга.

## Основные преимущества

- **Минимальная заметность**: Не используются функции приостановки и возобновления потоков
- **Экономия прав доступа**: Для работы достаточно базовых разрешений на чтение и запись
- **Сохранение работоспособности**: Целевое приложение продолжает стабильную работу после внедрения
- **Естественное выполнение**: Код активируется в рамках штатного цикла работы потоков

## Технические детали

### Принцип действия

Метод основан на перехвате потоков, находящихся в состоянии ожидания системных вызовов. Вместо модификации контекста выполнения производится замена адреса возврата в стеке потока. При завершении ожидания поток автоматически передает управление внедренному коду.

### Используемые механизмы

- Анализ состояния потоков через системные функции
- Чтение и модификация стека выполнения
- Создание исполняемых областей памяти в целевом процессе
- Автоматическое восстановление исходного потока выполнения

### Требуемые разрешения

- Для целевого процесса: `PROCESS_VM_OPERATION`, `PROCESS_VM_READ`, `PROCESS_VM_WRITE`
- Для целевого потока: `THREAD_GET_CONTEXT`

## Сборка и использование

### Требования

- Установленный компилятор Rust
- Целевая ОС: Windows 10/11 64-bit
- Средний или высокий уровень целостности процесса

### Компиляция

```bash
cargo build --release
```

### Запуск

```bash
waiting_thread_hijacking.exe <PID целевого процесса>
```

## Обход систем защиты

Технология успешно обходит следующие механизмы обнаружения:

- Мониторинг вызовов `SuspendThread`/`ResumeThread`
- Отслеживание модификации контекста потоков
- Детектирование создания удаленных потоков
- Анализ очередей асинхронных вызовов

## Восстановление работы

После выполнения целевого кода происходит автоматическое возвращение к исходному потоку инструкций. Все регистры процессора и флаги восстанавливаются в первоначальное состояние, что гарантирует стабильность работы перехваченного приложения.

## Применимость

Метод эффективен против процессов, использующих пулы потоков или ожидающие системные вызовы. Наилучшие результаты достигаются при работе с серверными приложениями и фоновыми службами.

## Важные замечания

- Технология предназначена для исследовательских целей
- Требует тщательного тестирования в целевой среде
- Эффективность зависит от конкретной конфигурации системы защиты
- Рекомендуется использование в рамках законных операций

## Лицензия

Проект распространяется для целей изучения методов кибербезопасности.

---

*Реализация основана на исследованиях механизмов работы потоков в операционных системах семейства Windows.*
```
